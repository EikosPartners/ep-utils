{"version":3,"sources":["../src/sortAndFilter.js"],"names":[],"mappings":"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","file":"sortAndFilter.js","sourcesContent":["var _module,\r\n    utils = require('./dataUtils'),\r\n    _ = require('lodash');\r\n\r\nvar compare = {\r\n    '=': function (l, r) {\r\n        return l == r; //use unstrict comparisions so strings can be compared with numbers\r\n    },\r\n    '!=': function (l, r) {\r\n        return l != r;\r\n    },\r\n    '<': function (l, r) {\r\n        return Number(l) < Number(r);\r\n    },\r\n    '>': function (l, r) {\r\n        return Number(l) > Number(r);\r\n    },\r\n    '<=': function (l, r) {\r\n        return Number(l) <= Number(r);\r\n    },\r\n    '>=': function (l, r) {\r\n        return Number(l) >= Number(r);\r\n    },\r\n    'minDate': function (l, r) {\r\n        return new Date(l) >= new Date(r);\r\n    },\r\n    'maxDate': function (l, r) {\r\n        return new Date(l) <= new Date(r);\r\n    },\r\n    'in': function(l, r) {\r\n      return r.indexOf(l) >-1 ;\r\n    },\r\n    'contains': function (l, r) {\r\n        //console.log(\"contains\", arguments);\r\n        return Array.isArray(l) || typeof l === \"string\" ? l.indexOf(r) !== -1 : false;\r\n    },\r\n    'notcontains': function (l, r) {\r\n        //console.log(\"notcontains\", arguments);\r\n        return Array.isArray(l) || typeof l === \"string\" ? l.indexOf(r) === -1 : false;\r\n    },\r\n    'containsatleastone': function (l, r) {\r\n        //console.log(\"containsatleastone\", arguments);\r\n        if (!Array.isArray(l) || !Array.isArray(r)) return false;\r\n        return r.some(function (i) {\r\n            return l.indexOf(i) !== -1;\r\n        });\r\n    },\r\n    \"startsWithCI\": function(l, r) {\r\n        return String(l).toUpperCase().indexOf(String(r).toUpperCase()) === 0;\r\n    },\r\n    '': function () {\r\n        return true;\r\n    }\r\n};\r\n\r\nmodule.exports = _module = {\r\n    get_type: function (fields, field) {\r\n        for (var i = 0; i < fields.length; i++) {\r\n            if (fields[i].id === field) {\r\n                return fields[i].type;\r\n            }\r\n        }\r\n    },\r\n    sort: function (data, type, sort_column, sort_order) {\r\n        var asc;\r\n        if (sort_column != null) {\r\n            asc = (sort_order == null || sort_order === true || sort_order.toUpperCase() !== 'DESC') ? 1 : -1;\r\n            data = data.sort(function (a, b) {\r\n                var result;\r\n                if (a[sort_column] === undefined) {\r\n                    result = 0;\r\n                }\r\n                else {\r\n                    switch (type) {\r\n                        case \"number\":\r\n                            result = Number(a[sort_column]) - Number(b[sort_column]);\r\n                            break;\r\n                        case \"datetime\":\r\n                            var first = Date.parse(a[sort_column]),\r\n                                second = Date.parse(b[sort_column]);\r\n                            result = first === second ? 0 : first - second > 0 ? 1 : -1;\r\n                            break;\r\n                        case \"checkbox\":\r\n                            result = (a[sort_column] === b[sort_column])? 0 : a[sort_column]? -1 : 1;\r\n                            break;\r\n                        default:\r\n                            result = a[sort_column].toString()\r\n                                .localeCompare(b[sort_column].toString());\r\n                            break;\r\n                    }\r\n                }\r\n                return asc * result;\r\n            });\r\n        }\r\n        return data;\r\n    },\r\n    // search box\r\n    filter: function (data, search) {\r\n\r\n        if (search !== undefined && search.indexOf(',') > -1) {\r\n            search = {\r\n                value : search.toUpperCase().replace(/ /g, '').split(','),\r\n                'op' : 'in'\r\n            };\r\n        } else {\r\n            search = {\r\n                value: search,\r\n                op: \"startsWithCI\"\r\n            };\r\n        }\r\n        if (search != null && String(search) != \"\") {\r\n            return data.filter(function (item) {\r\n                return Object.keys(item).reduce(function (prev, field) {\r\n                    var filtered = _module.filter_switch(item, field, search)\r\n                    return prev || filtered;\r\n                }, false);\r\n            });\r\n        }\r\n        return data;\r\n    },\r\n    // filter for columns\r\n    filter_columns: function (data, filters) {\r\n        if (filters != null) {\r\n            return data.filter(function (item) {\r\n                return Object.keys(filters).reduce(function (prev, filter) {\r\n                    return prev\r\n                        && _module.filter_switch(item, filter, filters[filter]);\r\n                }, true);\r\n            });\r\n        }\r\n        return data;\r\n    },\r\n    filter_switch: function (item, filterId, filter) {\r\n            // change simple filter to complex filter if needed\r\n            if(Array.isArray(filter) || typeof filter !== \"object\") {\r\n                if(Array.isArray(filter)) {\r\n                    filter = filter.map(function(f) {\r\n                        if(typeof f !== \"object\") {\r\n                            return {\r\n                                value: f\r\n                            };\r\n                        }\r\n                        return f;\r\n                    });\r\n                } else {\r\n                    filter = {\r\n                        \"value\": filter\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (compare[filter.op]) {\r\n                return compare[filter.op](item[filterId], filter.value);\r\n            }\r\n            // operator not defined. perform default compare\r\n            if (filter instanceof Array) {\r\n\r\n                // see if value exists in array\r\n                return filter.reduce(function (prev, filterObj, index) {\r\n                    // if filter contains a comparison operator, initial value\r\n                    // should be true, as the return will be 'and'ing the values\r\n                    if (filterObj.op && compare[filterObj.op]) {\r\n                        prev = index === 0 ? true : prev;\r\n                        return prev && compare[filterObj.op](item[filterId], filterObj.value)\r\n                    }\r\n                    var result =  prev || filterObj.value.indexOf(item[filterId]) === 0 ;\r\n                    return result;\r\n                }, false);\r\n            }\r\n\r\n            return String(item[filterId]).indexOf(filter.value) === 0;\r\n\r\n    },\r\n    search: function (data, options, callback) {\r\n\r\n        var start = Number(options.start) || 0,\r\n            search = options.search,\r\n            filters = options.filters,\r\n            orderby = options.orderby;\r\n\r\n        if (utils.DEBUG) console.log('search options', JSON.stringify(options));\r\n\r\n        for (var key in orderby) {\r\n            _module.sort(data, orderby[key].type, key, orderby[key].dir);\r\n        }\r\n\r\n        if (search) {\r\n            data = _module.filter(data, search);\r\n        }\r\n        if (filters) {\r\n            data = _module.filter_columns(data, filters);\r\n        }\r\n\r\n        var count = Number(options.count);\r\n        if (count === undefined || count < 0 || isNaN(count)) {\r\n            count = data.length;\r\n        }\r\n        // if no resultskey is given use SearchResult\r\n        var resultsKey = \"SearchResult\";\r\n        if(options.resultsKey){\r\n            resultsKey = options.resultsKey;\r\n        }\r\n        var results = {};\r\n        results[resultsKey]  = data.slice(start, start + count);\r\n        results.final =  start + count >= data.length;\r\n        results.total = data.length;\r\n        callback(null, results);\r\n    }\r\n\r\n}\r\n"]}